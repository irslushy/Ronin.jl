<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reference · Ronin.jl</title><meta name="title" content="Reference · Ronin.jl"/><meta property="og:title" content="Reference · Ronin.jl"/><meta property="twitter:title" content="Reference · Ronin.jl"/><meta name="description" content="Documentation for Ronin.jl."/><meta property="og:description" content="Documentation for Ronin.jl."/><meta property="twitter:description" content="Documentation for Ronin.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Ronin.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li class="is-active"><a class="tocitem" href="api.html">Reference</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#API-/-Function-References"><span>API / Function References</span></a></li><li><a class="tocitem" href="#Calculating-Model-Input-Features"><span>Calculating Model Input Features</span></a></li><li><a class="tocitem" href="#Applying-and-evaluating-a-trained-model-to-data"><span>Applying and evaluating a trained model to data</span></a></li><li><a class="tocitem" href="#Predicting-using-a-composite-model"><span>Predicting using a composite model</span></a></li><li><a class="tocitem" href="#Non-user-facing"><span>Non-user facing</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="api.html">Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="api.html">Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/irslushy/Ronin.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/irslushy/Ronin.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-Workflow-Walkthrough"><a class="docs-heading-anchor" href="#Basic-Workflow-Walkthrough">Basic Workflow Walkthrough</a><a id="Basic-Workflow-Walkthrough-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Workflow-Walkthrough" title="Permalink"></a></h1><p>RadarQC is a package that utilizes a methodology developed by <a href="https://journals.ametsoc.org/view/journals/aies/aop/AIES-D-23-0064.1/AIES-D-23-0064.1.xml">Dr. Alex DesRosiers and Dr. Michael Bell</a> to remove non-meteorological gates from Doppler radar scans by leveraging machine learning techniques. In its current form, it contains functionality to derive a set of features from input radar data, use these features to train a Random Forest classification model, and apply this model to the raw fields contained within the radar scans. It also has some model evaluation ability. The beginning of this guide will walk through a basic workflow to train a model starting from scratch. </p><h1 id="API-/-Function-References"><a class="docs-heading-anchor" href="#API-/-Function-References">API / Function References</a><a id="API-/-Function-References-1"></a><a class="docs-heading-anchor-permalink" href="#API-/-Function-References" title="Permalink"></a></h1><h2 id="Calculating-Model-Input-Features"><a class="docs-heading-anchor" href="#Calculating-Model-Input-Features">Calculating Model Input Features</a><a id="Calculating-Model-Input-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-Model-Input-Features" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.calculate_features-Tuple{String, String, String, Bool}" href="#Ronin.calculate_features-Tuple{String, String, String, Bool}"><code>Ronin.calculate_features</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Function to process a set of cfradial files and produce input features for training/evaluating a model </p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">input_loc::String</code></pre><p>Path to input cfradial or directory of input cfradials </p><pre><code class="language-julia hljs">argument_file::String</code></pre><p>Path to configuration file containing which features to calculate </p><pre><code class="language-julia hljs">output_file::String</code></pre><p>Path to output calculated features to (generally ends in .h5)</p><pre><code class="language-julia hljs">HAS_INTERACTIVE_QC::Bool</code></pre><p>Specifies whether or not the file(s) have already undergone a interactive QC procedure.  If true, function will also output a <code>Y</code> array used to verify where interactive QC removed gates. This array is formed by considering where gates with non-missing data in raw scans (specified by <code>remove_variable</code>) are set to missing after QC is performed. </p><p><strong>Optional keyword arguments</strong></p><pre><code class="language-julia hljs">verbose::Bool=false</code></pre><p>If true, will print out timing information as each file is processed </p><pre><code class="language-julia hljs">REMOVE_LOW_NCP::Bool=false</code></pre><p>If true, will ignore gates with Normalized Coherent Power/Signal Quality Index below a threshold specified in RQCFeatures.jl</p><pre><code class="language-julia hljs">REMOVE_HIGH_PGG::Bool=false</code></pre><p>If true, will ignore gates with Probability of Ground Gate (PGG) values at or above a threshold specified in RQCFeatures.jl </p><pre><code class="language-julia hljs">QC_variable::String=&quot;VG&quot;</code></pre><p>Name of variable in input NetCDF files that has been quality-controlled. </p><pre><code class="language-julia hljs">remove_variable::String=&quot;VV&quot;</code></pre><p>Name of a raw variable in input NetCDF files. Used to determine where missing data exists in the input sweeps.  Data at these locations will be removed from the outputted features. </p><pre><code class="language-julia hljs">replace_missing::Bool=false</code></pre><p>Whether or not to replace MISSING values with FILL_VAL in spatial parameter calculations Default value: False </p><pre><code class="language-julia hljs">write_out::Bool=true</code></pre><p>Whether or not to write features out to file </p><pre><code class="language-julia hljs">return_idxer::Bool = false</code></pre><p>If true, will return IDXER, where IDXER is a </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L207-L284">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.calculate_features-Tuple{String, Vector{String}, Vector{Matrix{Union{Missing, Float64}}}, String, Bool}" href="#Ronin.calculate_features-Tuple{String, Vector{String}, Vector{Matrix{Union{Missing, Float64}}}, String, Bool}"><code>Ronin.calculate_features</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Function to process a set of cfradial files and produce input features for training/evaluating a model.      Allows for user-specified tasks and weight matrices, otherwise the same as above.  </p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">input_loc::String</code></pre><p>Path to input cfradial or directory of input cfradials </p><pre><code class="language-julia hljs">tasks::Vector{String}</code></pre><p>Vector containing the features to be calculated for each cfradial. Example <code>[DBZ, ISO(DBZ)]</code></p><pre><code class="language-julia hljs">weight_matrixes::Vector{Matrix{Union{Missing, Float64}}}</code></pre><p>For each task, a weight matrix specifying how much each gate in a spatial calculation will be given.  Required to be the same size as <code>tasks</code></p><pre><code class="language-julia hljs">output_file::String </code></pre><p>Location to output the calculated feature data to. </p><pre><code class="language-julia hljs">HAS_INTERACTIVE_QC::Bool</code></pre><p>Specifies whether or not the file(s) have already undergone a interactive QC procedure.  If true, function will also output a <code>Y</code> array used to verify where interactive QC removed gates. This array is formed by considering where gates with non-missing data in raw scans (specified by <code>remove_variable</code>) are set to missing after QC is performed. </p><p><strong>Optional keyword arguments</strong></p><pre><code class="language-julia hljs">verbose::Bool = false </code></pre><p>If true, will print out timing information as each file is processed </p><pre><code class="language-julia hljs">REMOVE_LOW_NCP::Bool = false </code></pre><p>If true, will ignore gates with Normalized Coherent Power/Signal Quality Index below a threshold specified in RQCFeatures.jl</p><pre><code class="language-julia hljs">REMOVE_HIGH_PGG::Bool = false</code></pre><p>If true, will ignore gates with Probability of Ground Gate (PGG) values at or above a threshold specified in RQCFeatures.jl </p><pre><code class="language-julia hljs">QC_variable::String = &quot;VG&quot;</code></pre><p>Name of variable in input NetCDF files that has been quality-controlled. </p><pre><code class="language-julia hljs">remove_variable::String = &quot;VV&quot;

Name of a raw variable in input NetCDF files. Used to determine where missing data exists in the input sweeps. 
Data at these locations will be removed from the outputted features. 
</code></pre><p>replace_missing::Bool = false </p><pre><code class="nohighlight hljs">Whether or not to replace MISSING values with FILL_VAL in spatial parameter calculations
Default value: False 
</code></pre><p>julia write_out::Bool = true  ``` Whether or not to write out to file. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L398-L478">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.split_training_testing!" href="#Ronin.split_training_testing!"><code>Ronin.split_training_testing!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Function to split a given directory or set of directories into training and testing files using the configuration described in DesRosiers and Bell 2023. <strong>This function assumes that input directories only contain cfradial files  that follow standard naming conventions, and are thus implicitly chronologically ordered.</strong> The function operates  by first dividing file names into training and testing sets following an 80/20 training/testing split, and subsequently softlinking each file to the training and testing directories. Attempts to avoid temporal autocorrelation while maximizing  variance by dividing each case into several different training/testing sections. </p><p><strong>Required Arguments:</strong></p><pre><code class="language-julia hljs">DIR_PATHS::Vector{String}</code></pre><p>List of directories containing cfradials to be used for model training/testing. Useful if input data is split  into several different cases. </p><pre><code class="language-julia hljs">TRAINING_PATH::String </code></pre><p>Directory to softlink files designated for training into. </p><pre><code class="language-julia hljs">TESTING_PATH::String </code></pre><p>Directory to softlink files designated for testing into. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L1024-L1049">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.train_model-Tuple{String, String}" href="#Ronin.train_model-Tuple{String, String}"><code>Ronin.train_model</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Function to train a random forest model using a precalculated set of input and output features (usually output from  <code>calculate_features</code>). Returns nothing. </p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">input_h5::String</code></pre><p>Location of input features/targets. Input features are expected to have the name &quot;X&quot;, and targets the name &quot;Y&quot;. This should be  taken care of automatically if they are outputs from <code>calculate_features</code></p><pre><code class="language-julia hljs">model_location::String </code></pre><p>Path to save the trained model out to. Typically should end in <code>.jld2</code></p><p><strong>Optional keyword arguments</strong></p><pre><code class="language-julia hljs">verify::Bool = false </code></pre><p>Whether or not to output a separate .h5 file containing the trained models predictions on the training set  (<code>Y_PREDICTED</code>) as well as the targets for the training set (<code>Y_ACTUAL</code>) </p><pre><code class="language-julia hljs">verify_out::String=&quot;model_verification.h5&quot;</code></pre><p>If <code>verify</code>, the location to output this verification to. </p><pre><code class="language-julia hljs">col_subset=: </code></pre><p>Set of columns from <code>input_h5</code> to train model on. Useful if one wishes to train a model while excluding some features from a training set. </p><pre><code class="language-julia hljs">row_subset=:</code></pre><p>Set of rows from <code>input_h5</code> to train on.</p><pre><code class="language-julia hljs">n_trees::Int = 21</code></pre><p>Number of trees in the Random Forest ensemble </p><pre><code class="language-julia hljs">max_depth::Int = 14</code></pre><p>Maximum node depth in each tree in RF ensemble </p><pre><code class="language-julia hljs">class_weights::Vector{Float32} = Vector{Float32}([1.,2.])</code></pre><p>Vector of class weights to apply to each observation. Should be 1 observation per sample in the input data files </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L593-L646">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.remove_validation" href="#Ronin.remove_validation"><code>Ronin.remove_validation</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p><strong>Function used to remove a given subset of the rows from a feature set so that they may be used for model validation/tuning.</strong></p><p><strong>Currently configured to utilize the 90/10 split described in DesRosiers and Bell 2023.</strong></p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">input_dataset::String</code></pre><p>Path to h5 files containing model features </p><p><strong>Optional keyword arguments</strong></p><pre><code class="language-julia hljs">training_output::String = &quot;train_no_validation_set.h5&quot;</code></pre><p>Path to output training features with validation removed to </p><pre><code class="language-julia hljs">validation_output::String = &quot;validation.h5&quot;</code></pre><p>Path to output validation features to</p><pre><code class="language-julia hljs">remove_original::Bool = true </code></pre><p>Whether or not to remove the original file described by the <code>input_dataset</code> path. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Io.jl#L4-L29">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.get_feature_importance-Tuple{String, Vector{Float64}}" href="#Ronin.get_feature_importance-Tuple{String, Vector{Float64}}"><code>Ronin.get_feature_importance</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p><strong>Uses L1 regression with a variety of λ penalty values to determine the most useful features for</strong></p><p>input to the random forest model.  </p><hr/><p><strong>Required Input</strong></p><hr/><pre><code class="language-julia hljs">input_file_path::String </code></pre><p>Path to .h5 file containing model training features under <code>[&quot;X&quot;]</code> parameter, and model targets under <code>[&quot;Y&quot;]</code> parameter.   Also expects the h5 file to contain an attribute known as <code>Parameters</code> containing abbreviations for the feature types </p><pre><code class="language-julia hljs">λs::Vector{Float64}</code></pre><p><strong>Vector of values used to vary the strength of the penalty term in the regularization.</strong></p><p><strong>Optional Keyword Arguments</strong></p><hr/><pre><code class="language-julia hljs">pred_threshold::Float64</code></pre><p><strong>Minimum cofidence level for binary classifier when predicting</strong></p><p><strong>Returns</strong></p><p>Returns a DataFrame with each row containing info about a regression for a specific λ, the values of the regression coefficients      for each input feature, and the Root Mean Square Error of the resultant regression. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L1329-L1368">source</a></section></article><h2 id="Applying-and-evaluating-a-trained-model-to-data"><a class="docs-heading-anchor" href="#Applying-and-evaluating-a-trained-model-to-data">Applying and evaluating a trained model to data</a><a id="Applying-and-evaluating-a-trained-model-to-data-1"></a><a class="docs-heading-anchor-permalink" href="#Applying-and-evaluating-a-trained-model-to-data" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.QC_scan" href="#Ronin.QC_scan"><code>Ronin.QC_scan</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Primary function to apply a trained RF model to certain raw fields of a cfradial scan. Values determined to be  non-meteorological by the RF model will be replaced with <code>Missing</code></p><p><strong>Required Arguments</strong></p><pre><code class="language-julia hljs">file_path::String </code></pre><p>Location of input cfradial or directory of cfradials one wishes to apply QC to </p><pre><code class="language-julia hljs">config_file_path::String </code></pre><p>Location of config file containing features to calculate as inputs to RF model </p><pre><code class="language-julia hljs">model_path::String </code></pre><p>Location of trained RF model (in jld2 file format) </p><p><strong>Optional Arguments</strong></p><pre><code class="language-julia hljs">VARIABLES_TO_QC::Vector{String} = [&quot;ZZ&quot;, &quot;VV&quot;]</code></pre><p>List containing names of raw variables in the CFRadial to apply QC algorithm to. </p><pre><code class="language-julia hljs">QC_suffix::String = &quot;_QC&quot;</code></pre><p>Used for naming the QC-ed variables in the modified CFRadial file. Field name will be QC<em>suffix appended to the raw field.  Example: `DBZ</em>QC`</p><pre><code class="language-julia hljs">indexer_var::String = &quot;VV&quot;</code></pre><p>Variable used to determine what gates are considered &quot;missing&quot; in the raw moments. QC will not  be applied to these gates, they will simply remain missing. </p><pre><code class="language-julia hljs">decision_threshold::Float64 = .5</code></pre><p>Used to leverage probablistic nature of random forest methodology. When the model has a greater than <code>decision_threshold</code> level confidence that a gate is meteorological data, it will be assigned as such. Anything at or below this confidence threshold will be assigned non-meteorological. At least in the ELDORA case, aggressive thresholds (.8 and above) have been found to maintain </p><blockquote><p>92% of the meteorological data while removing &gt;99% of non-meteorological gates. </p></blockquote><pre><code class="language-julia hljs">output_mask::Bool = true</code></pre><p>Whether or not to output the QC preditions from the model output. A value of 0 means the model predicted the gate to be non-meteorological, 1 corresponds to predicted meteorological data, and -1 denotes data that did not meet minimum thresholds</p><pre><code class="language-julia hljs">mask_name::String = &quot;QC_MASK&quot;</code></pre><p>What to name the output QC predictions. </p><pre><code class="language-julia hljs">verbose::Bool = false 
````
Whether to output timing and scan information
</code></pre><p>julia output_probs::Bool = false</p><pre><code class="nohighlight hljs">Whether or not to output probabilities of meteorological gate from random forest </code></pre><p>julia prob_varname::String = &quot;&quot; ``` What to name the probability variable in the cfradial file </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L800-L871">source</a></section><section><div><p>Version of QC_Scan used for multiple-pass models.  Required argument is a model configuration object. Optional arguments: </p><pre><code class="language-julia hljs">output_probs::Bool = false </code></pre><p>Whether or not to write the modeled probabilities to file </p><pre><code class="language-julia hljs">prob_name::String </code></pre><p>What to name the probability variable to file </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L1956-L1969">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.predict_with_model-Tuple{String, String}" href="#Ronin.predict_with_model-Tuple{String, String}"><code>Ronin.predict_with_model</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Simple function that opens a given h5 file with feature data and applies a specific model to it.  Returns a tuple of <code>predictions, targets</code>. Also contains the ability to write these predictions and solutions  out to a separate h5 file. </p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">model_path::String </code></pre><p>Location of trained RF model (saved in jld2 file format) </p><pre><code class="language-julia hljs">input_h5::String </code></pre><p>Location of h5 file containing input features. </p><p><strong>Optional Keyword Arguments</strong></p><pre><code class="language-julia hljs">write_out::Bool = false</code></pre><p>Whether or not to write the results out to a file </p><pre><code class="language-julia hljs">outfile::String = Path to write results to if write_out == true </code></pre><p>Results will be written in the h5 format with the name &quot;Predicitions&quot; and &quot;Ground Truth&quot; </p><pre><code class="language-julia hljs">probability_threshold::Float32 = .5</code></pre><p>Minimum fraction of trees classifying a gate as meteorological for it to be assigned a label of meteorological</p><pre><code class="language-julia hljs">row_subset=:</code></pre><p>Selection of rows to predict upon </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L735-L772">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.evaluate_model-Tuple{String, String, String}" href="#Ronin.evaluate_model-Tuple{String, String, String}"><code>Ronin.evaluate_model</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Function that takes in a given model, directory containing either cfradials or an already processed h5 file,  a path to the configuration file, and a mode type (&quot;C&quot; for cfradials &quot;H&quot; for h5) and returns a Julia DataFrame  containing a variety of metrics about the model&#39;s performance on the specified set, including precision and recall scores. </p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">model_path::String</code></pre><p>Path to input trained random forest model</p><pre><code class="language-julia hljs">input_file_dir::String</code></pre><p>Path to input h5 file or directory of cfradial files to be processed</p><pre><code class="language-julia hljs">config_file_path </code></pre><p>Path to configuration file containing information about what features to calculate </p><p><strong>Optional Arguments</strong></p><pre><code class="language-julia hljs">mode::String = &quot;C&quot;</code></pre><p>Whether to process a directory of cfradial files (&quot;C&quot; mode) or simply utilize an already-processed h5 file (&quot;H&quot; mode) </p><pre><code class="language-julia hljs">write_out::Bool = false</code></pre><p>If in &quot;C&quot; mode, whether or not to write the resulting calculated features out to a file </p><pre><code class="language-julia hljs">output_file::String = &quot;_.h5&quot; </code></pre><p>Location to write calculated output features to. </p><pre><code class="language-julia hljs">col_subset = : </code></pre><p>Subset of columns of <code>X</code> array to input to model. </p><p>Also contains all keyword arguments for calculate_features </p><pre><code class="language-julia hljs">proba_seq::StepRangeLen = .1:.1:.9</code></pre><p>Sequence of probabilities to iterate through when evaluating the model </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L1188-L1242">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.error_characteristics-Tuple{String, String, String}" href="#Ronin.error_characteristics-Tuple{String, String, String}"><code>Ronin.error_characteristics</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">error_characteristics(file_path::String, config_file_path::String, model_path::String;
indexer_var::String=&quot;VV&quot;, QC_variable::String=&quot;VG&quot;, decision_threshold::Float64 = .5, write_out::Bool=false,
output_name::String=&quot;Model_Error_Characteristics.h5&quot;)</code></pre><p>Function to process a set of cfradial files that have already been interactively QC&#39;ed and return information about where errors  occur in the files relative to model predictions. Requires a pre-trained model and configuration, as well as scans that  have already been interactively quality controlled. </p><p>#Required Arguments </p><pre><code class="language-julia hljs">file_path::String</code></pre><p>Path to file or directory of cfradials to be processed</p><pre><code class="language-julia hljs">config_file_path::String</code></pre><p>Path to configuration file containing parameters to calculate for the cfradials </p><pre><code class="language-julia hljs">model_path::String</code></pre><p>Path to pre-trained random forest model </p><p><strong>Optional keyword arguments</strong></p><pre><code class="language-julia hljs">indexer_var::String=&quot;VV&quot; </code></pre><p>Name of a raw variable in input NetCDF files. Used to determine where missing data exists in the input sweeps.  Data at these locations will be removed from the outputted features. </p><pre><code class="language-julia hljs">QC_variable::String=&quot;VG&quot;</code></pre><p>Name of variable in CFRadial files that has already been interactively QC&#39;ed. Used as the verification data. </p><pre><code class="language-julia hljs">decision_threshold::Float64 = .5</code></pre><p>Fraction of decision trees in the RF model that must agree for a given gate to be classified as meteorological.  For example, at .5, &gt;=50% of the trees must predict that a gate is meteorological for it to be classified as such,  otherwise it is assigned as non-meteorological. </p><pre><code class="language-julia hljs">write_out::Bool=false</code></pre><p>Whether or not to output the model evaluation data to an HDF5 file </p><pre><code class="language-julia hljs">output_name::String=&quot;Model_Error_Characteristics.h5&quot;</code></pre><p>Name/Path of desired HDF5 output location </p><p><strong>Returns</strong></p><p>Returns a tuple of (X, Y, indexer, predictions, false<em>positives, false</em>negatives)  Where</p><pre><code class="language-julia hljs">X::Matrix{Float64}</code></pre><p>Each row in X represents a different radar gate, while each column a different parameter as according to the order  that they are listed in the config<em>file</em>path </p><pre><code class="language-julia hljs">Y::Matrix{Int64} </code></pre><p>Each row in Y represents a radar gate, and its classification according to the interactive QC applied to it. </p><pre><code class="language-julia hljs">indexer::Matrix{Int64}</code></pre><p>For all gates in the input directory, contains 1 if the gate passed basic QC thresholds (Low NCP, etc.) and 0 if it did not.  Useful if one wishes to reconstruct 2D scan from flattened data </p><pre><code class="language-julia hljs">predictions:Matrix{Int32}</code></pre><p>Trained machine learning model predictions for the classification of a gate - <code>1</code> if predicted to be      meteorological data, <code>0</code> otherwise. </p><pre><code class="language-julia hljs">false_postivies::BitMatrix</code></pre><p>Which gates were misclassified as meteorological data relative to interactive QC</p><pre><code class="language-julia hljs">false_negatives::BitMatrix</code></pre><p>Which gates were misclassified as non-meteorological data relative to interactive QC </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L1417-L1508">source</a></section></article><h2 id="Predicting-using-a-composite-model"><a class="docs-heading-anchor" href="#Predicting-using-a-composite-model">Predicting using a composite model</a><a id="Predicting-using-a-composite-model-1"></a><a class="docs-heading-anchor-permalink" href="#Predicting-using-a-composite-model" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.ModelConfig" href="#Ronin.ModelConfig"><code>Ronin.ModelConfig</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p><strong>Stuct used to store configuration information for a given model</strong></p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">num_models:::Int64</code></pre><p>Number of ML models in the model chain. Can be one or more. </p><pre><code class="language-julia hljs">model_output_paths::Vector{String}</code></pre><p>Vector containing paths to each model in the model chain. Should be same length as the number of models </p><pre><code class="language-julia hljs">met_probs::Vector{Tuple{Float64,Float64}}</code></pre><p>Vector containing the decision range for a gate to be considered meteorological in each model in the chain. Example, if set to (.9, 1),      &gt; 90% of trees in the random forest must assign a gate a label of meteorological for it to be considered meteorological.      The range is exclusive on the lower end and inclusive on the high end. Form is (low<em>threshold, high</em>threshold)</p><pre><code class="language-julia hljs">feature_output_paths::Vector{String}</code></pre><p>Vector containing paths representing the locations to output calculated features to for each model in the chain. </p><pre><code class="language-julia hljs">input_path::String</code></pre><p>Directory containing input radar data </p><pre><code class="language-julia hljs">input_config::String </code></pre><p>Path to file containing feature variables to calculate </p><pre><code class="language-julia hljs">file_preprocessed::Vector{Bool}</code></pre><p>For each model in the chain, contains a boolean value signifying if the correspondant feature output path has already been processed. If true,  will open the file at this path instead of re-calculating input features. </p><p><strong>Optional arguments</strong></p><pre><code class="language-julia hljs">verbose::Bool = true </code></pre><p>Whether to print out timing information, etc. </p><pre><code class="language-julia hljs">REMOVE_LOW_NCP::Bool = true</code></pre><p>Whether to automatically remove gates that do not meet a basic NCP threshold </p><pre><code class="language-julia hljs">REMOVE_HIGH_PGG::Bool = true</code></pre><p>Whether to automatically remove gates that do not meet a basic PGG threshold </p><pre><code class="language-julia hljs">HAS_INTERACTIVE_QC::Bool = false </code></pre><p>Whether the radar data has already had interactive QC applied to it </p><pre><code class="language-julia hljs">QC_var::String = &quot;VG&quot;</code></pre><p>If radar data has interactive QC already applied, the name of a variable that the QC has been applied to </p><pre><code class="language-julia hljs">remove_var::String = &quot;VV&quot; </code></pre><p>Name of a raw variable in the radar data that can be used to determine the location of missing gates </p><pre><code class="language-julia hljs">replace_missing::Bool = false </code></pre><p>For spatial feature (AVG, STD, etc.) calculation, whether or not to replace MISSING gates in the mask area with FILL_VAL </p><pre><code class="language-julia hljs">write_out::Bool = true </code></pre><p>Whether or not to write the calculated input features to disk, paths specified in feature<em>output</em>paths</p><pre><code class="language-julia hljs">QC_mask::Bool = false </code></pre><p>For the first model in the chain, whether or not to mask gates considered for feature calculation using a mask specified by <code>mask_name</code> More details elsewhere in the documentation. </p><pre><code class="language-julia hljs">mask_name::String = &quot;&quot;</code></pre><p>See above </p><pre><code class="language-julia hljs">VARS_TO_QC::Vector{String} = [&quot;VV&quot;, &quot;ZZ&quot;]</code></pre><p>List of variables to apply QC to to get mask for next model in chain </p><pre><code class="language-julia hljs">QC_SUFFIX::String</code></pre><p>Postfix to apply to variable name once QC has been applied. </p><pre><code class="language-julia hljs">class_weights::String = &quot;&quot;</code></pre><p>Class weighting scheme to apply in the training of RF model. Currently only &quot;balanced&quot; is implemented. </p><pre><code class="language-julia hljs">n_trees::Int = 21</code></pre><p>Number of trees in the random forest </p><pre><code class="language-julia hljs">max_depth::Int = 14</code></pre><p>Maximum depth of any one tree in the random forest </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L34-L153">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.train_multi_model" href="#Ronin.train_multi_model"><code>Ronin.train_multi_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">train_multi_model(config::ModelConfig)</code></pre><p>All-in-one function to take in a set of radar data, calculate input features, and train a chain of random forest models  for meteorological/non-meteorological gate identification. </p><p>#Required arguments </p><pre><code class="language-julia hljs">config::ModelConfig</code></pre><p>Struct containing configuration info for model training </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L1657-L1668">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.composite_prediction" href="#Ronin.composite_prediction"><code>Ronin.composite_prediction</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">composite_prediction(config::ModelConfig)</code></pre><p>Passes feature data through a model or series of models and returns model classifications. Applies configuration such as  masking and basic QC (high PGG/low NCP) specified by <code>config</code></p><p><strong>Returns</strong></p><ul><li><p><code>predictions::Vector{Bool}</code> Model classifications for gates that passed basic quality control thresholds </p></li><li><p><code>values::BitVector</code> Verification gates correspondant to predictions </p></li><li><p><code>init_idxers::Vector{Vector{Float64}}</code> Information about where original radar data did/did not meet basic quality control thresholds.                                        Each vector contains a flattened vector describing whether or not a given gate was predicted on. </p></li><li><p><code>total_met_probs::Vector{Float64}</code>If kewyword argument return<em>probs is set to <code>true</code>, then `total</em>met_probs` will be returned. Each entry                                    into this vector corresponds to the gate represented by predictions and values, and denotes the fraction of                                    trees in the random forest that classified the gate as meteorological.</p><p>All values returned will be only those that passed quality control checks in the first pass of the model    minimum NCP / PGG thresholds. In order to reconstruct a scan, user would need to use the values in the returned indexers. </p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L2029-L2047">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.multipass_uncertain" href="#Ronin.multipass_uncertain"><code>Ronin.multipass_uncertain</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">multipass_uncertain(base_config::ModelConfig, low_threshold::Float64, high_threshold::Float64; 
low_model_path::String = &quot;low_config_model.jld2&quot;, skip_training_base=false)</code></pre><p>Function that takes in a set of model parameters, trains a model on the entire dataset, and then isolates gates that trees in the forest have trouble agreeing upon. More specifically, will isolate gates that  have &gt; <code>low_threshold</code> but &lt; <code>high_threshold</code> fraction of trees in agreement that they are meteorological. It will  subsequently train a random forest model specifically on these gates, saving it to <code>ambig_model.jld2</code></p><p><strong>Required Arguments</strong></p><ul><li><code>base_config::ModelConfig</code> Model configuration object that contains information about input data and where to write models to </li><li><code>low_threshold::Float64</code> Used for selecting ambiguous gates, the minimum fraction of trees that must agree for a datapoint to be considered </li><li><code>high_threshold::Float64</code> Used for selecting ambiguous gates, the maximum fraction of trees that may classify a gate as meteorological for it to be considered</li></ul><p><strong>Optional Arguments</strong></p><ul><li><code>low_model_path::String=&quot;low_config_model.jld2&quot;</code>` Where to output the base model (trained on all gates) to</li><li><code>ambig_model_path::String=&quot;ambig_model.jld2&quot;</code> Where to output model trained on difficult gates to </li><li><code>skip_training_base::Bool=false</code> If base model has already been trained, set to <code>true</code> to skip retraining </li><li><code>mode::String = &quot;train&quot;</code> Options are &quot;train&quot; or &quot;predict&quot;. If mode == &quot;predict&quot;, will not do any model training</li></ul><p><strong>Returns</strong></p><p>Will return 3 items: A vector of predictions, a vector of verification data, and an indexer vector which can be used  to determine which gates fall between the low<em>threshold and high</em>threshold in the basic model. The prediction vector is a combination  of classifications from the model trained on the base set and the model trained on the difficult gates. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/Ronin.jl#L2206-L2231">source</a></section></article><h2 id="Non-user-facing"><a class="docs-heading-anchor" href="#Non-user-facing">Non-user facing</a><a id="Non-user-facing-1"></a><a class="docs-heading-anchor-permalink" href="#Non-user-facing" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.get_task_params" href="#Ronin.get_task_params"><code>Ronin.get_task_params</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Function to parse a given task list Also performs checks to ensure that the specified  tasks are able to be performed to the specified CFRad file</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/RoninFeatures.jl#L275-L278">source</a></section><section><div><p>Parses input parameter file for use in outputting feature names to      HDF5 file as attributes. NOTE: Cfradial-unaware. If one of the variables is      specified incorrectly in the parameter file, will cause errors</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/RoninFeatures.jl#L324-L328">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Ronin.process_single_file" href="#Ronin.process_single_file"><code>Ronin.process_single_file</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Driver function that calculates a set of features from a single CFRadial file. Features are  specified in file located at argfile_path. </p><p>Will return a tuple of (X, Y, indexer) where X is the features matrix,  <code>Y</code>, a matrix containing the verification </p><ul><li>where human QC determined the gate was meteorological (value of 1), or non-meteorological (value of 0), </li></ul><p>and <code>indexer</code> contains a vector of booleans describing which gates met basic quality control thresholds  and thus are represented in the X and Y matrixes</p><p>Weight matrixes are specified in file header, or passed as explicit argument. </p><p><strong>Required arguments</strong></p><pre><code class="language-julia hljs">cfrad::NCDataset </code></pre><p>Input <code>NCDataset</code> containing radar scan variables </p><pre><code class="language-julia hljs">argfile_path::String </code></pre><p>Path to file contaning config/task information. </p><p><strong>Optional keyword arguments</strong></p><pre><code class="language-julia hljs">HAS_INTERACTIVE_QC::Bool = false</code></pre><p>If the scan has already had a human apply quality control to it, set to <code>true</code>. Otherwise, <code>false</code></p><pre><code class="language-julia hljs">REMOVE_LOW_NCP::Bool = false</code></pre><p>Whether or not to ignore gates that do not meet a minimum NCP/SQI threshold. If <code>true</code>, these gates will be set to <code>false</code> in <code>indexer</code>, and features/verification will not be calculated for them. </p><pre><code class="language-julia hljs">REMOVE_HIGH_PGG::Bool = false</code></pre><p>Whether or not to ignore gates that exceed a given Probability of Ground Gate(PGG) threshold. If <code>true</code>, these gates will be set to <code>false</code> in <code>indexer</code>, and features/verification will not be calculated for them. </p><pre><code class="language-julia hljs">QC_variable::String = &quot;VG&quot;</code></pre><p>Name of a variable in input CFRadial file that has had QC applied to it already. Used to calculate verification <code>Y</code> matrix. </p><pre><code class="language-julia hljs">remove_variable::String = &quot;VV&quot; </code></pre><p>Name of raw variable in input CFRadial file that will be used to determine where <code>missing</code> gates exist in the sweep.</p><pre><code class="language-julia hljs">replace_missing::Bool = false</code></pre><p>For spatial parameters, whether or not to replace <code>missings</code> values with <code>FILL_VAL</code></p><hr/><p><strong>Returns:</strong></p><pre><code class="nohighlight hljs">-X: Array that is dimensioned (num_gates x num_features) where num_gates is the number of valid 
    (non-missing, meeting NCP/PGG thresholds) the function finds, and num_features is the 
    number of features specified in the argument file to calculate. 

-Y: IF HAS_INTERACTIVE_QC == true, will return Y, array containing 1 if a datapoint was retained 
    during interactive QC, and 0 otherwise. 

-INDEXER: Based on remove_variable as described above, contains boolean array specifiying
            where in the scan features valid data and where does not.</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/irslushy/Ronin.jl/blob/3a816a451c9c2b44e226b0537f14a3bdd4ff490b/src/RoninFeatures.jl#L363-L434">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 14 October 2024 21:42">Monday 14 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
