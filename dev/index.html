<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Ronin.jl</title><meta name="title" content="Home · Ronin.jl"/><meta property="og:title" content="Home · Ronin.jl"/><meta property="twitter:title" content="Home · Ronin.jl"/><meta name="description" content="Documentation for Ronin.jl."/><meta property="og:description" content="Documentation for Ronin.jl."/><meta property="twitter:description" content="Documentation for Ronin.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Ronin.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href="index.html">Home</a><ul class="internal"><li><a class="tocitem" href="#Preparing-input-data"><span>Preparing input data</span></a></li><li><a class="tocitem" href="#Training-a-Random-Forest-Model"><span>Training a Random Forest Model</span></a></li><li><a class="tocitem" href="#Applying-the-trained-model-to-a-radar-scan"><span>Applying the trained model to a radar scan</span></a></li><li><a class="tocitem" href="#Spatial-Predictors-Reference"><span>Spatial Predictors Reference</span></a></li><li><a class="tocitem" href="#Data-Conventions/Glossary"><span>Data Conventions/Glossary</span></a></li></ul></li><li><a class="tocitem" href="api.html">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="index.html">Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="index.html">Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/irslushy/Ronin.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/irslushy/Ronin.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>Ronin (Random forest Optimized Nonmeteorological IdentificatioN) is a package that utilizes a methodology developed by <a href="https://journals.ametsoc.org/view/journals/aies/aop/AIES-D-23-0064.1/AIES-D-23-0064.1.xml">Dr. Alex DesRosiers and Dr. Michael Bell</a> to remove non-meteorological gates from Doppler radar scans by leveraging machine learning techniques. In its current form, it contains functionality to derive a set of features from input radar data, use these features to train a Random Forest classification model, and apply this model to the raw fields contained within the radar scans. It also has some model evaluation ability. The beginning of this guide will walk through a basic workflow to train a model starting from scratch.  </p><h1 id="Workflow-Walkthrough"><a class="docs-heading-anchor" href="#Workflow-Walkthrough">Workflow Walkthrough</a><a id="Workflow-Walkthrough-1"></a><a class="docs-heading-anchor-permalink" href="#Workflow-Walkthrough" title="Permalink"></a></h1><h2 id="Preparing-input-data"><a class="docs-heading-anchor" href="#Preparing-input-data">Preparing input data</a><a id="Preparing-input-data-1"></a><a class="docs-heading-anchor-permalink" href="#Preparing-input-data" title="Permalink"></a></h2><hr/><p>The first step in the process is to split our data so that some of it may be utilized for model training and the other portion for model testing. It&#39;s important to keep the two sets separate, otherwise the model may overfit. </p><p>The basic requirement here is to have a directory or directories of cfradial scans, and two directories to put training and testing files, respectively. Make sure that no other files are present in these directories. To do this, the <a href="https://github.com/irslushy/Ronin.jl/blob/259aa4d306e09fedf9d4208bcc8a584fbabd89a2/src/Ronin.jl#L612"><code>split_training_testing!</code></a> function will be used. For example, if one had two cases of radar data, located in <code>./CASE1/</code> and <code>./CASE2/</code> and wanted to split into <code>./TRAINING</code> and <code>./TESTING</code>, execute the command </p><pre><code class="language-julia hljs">split_training_testing([&quot;./CASE1&quot;, &quot;./CASE2&quot;], &quot;./TRAINING&quot;, &quot;./TESTING&quot;)</code></pre><p>More information about this function is contained within the docs. </p><hr/><p>Now that we have split the input files, we can proceed to calculate the features used to train and test our Random Forest model. Further details are contained within the aforementioned manuscript, but it has been shown that the parameters contained <a href="https://github.com/irslushy/Ronin.jl/blob/259aa4d306e09fedf9d4208bcc8a584fbabd89a2/MODELS/DesRosiers_Bell_23/config.txt">here</a> are most effective for discriminating between meteorological/non-meteorological gates. For this, we will use the <a href="https://github.com/irslushy/Ronin.jl/blob/259aa4d306e09fedf9d4208bcc8a584fbabd89a2/src/Ronin.jl#L96-L181">calculate_features</a> function. Since we are calculating features to <strong>train</strong> a model at this point, we will assume that they have already a human apply QC. To get the most skillful model possible, we will want to remove &quot;easy&quot; cases from the training set, so set <code>REMOVE_LOW_NCP=true</code> and <code>REMOVE_HIGH_PGG=true</code> to ignore data not meeting minimum quality thresholds. It&#39;s also important to specify which variable contained with the input scans has already been QC&#39;ed - in the ELDORA scans, this is <code>VG</code>. <code>missing</code> values must also be removed from the initial training set, so we&#39;ll use a raw variable <code>VV</code> to determine where these gates are located. With that said, one may now invoke </p><pre><code class="language-julia hljs">calculate_features(&quot;./TRAINING&quot;, &quot;./config.txt&quot;, &quot;TRAINING_FEATURES.h5&quot;, true;
                    verbose=true, REMOVE_LOW_NCP = true, REMOVE_HIGH_PGG=true,
                    QC_variable=&quot;VG&quot;, remove_variable=&quot;VV&quot;)</code></pre><p>To use the config file located at <code>./config.txt</code> to output the training features to <code>TRAINING_FEATURES.h5</code>. </p><p>For clarity&#39;s sake, for the testing features this step would be exectued again but changing the input directory and output location. </p><p>This is a somewhat computationally expensive process for large datasets &gt;1000 scans, and so can take over 15 minutes. </p><hr/><h2 id="Training-a-Random-Forest-Model"><a class="docs-heading-anchor" href="#Training-a-Random-Forest-Model">Training a Random Forest Model</a><a id="Training-a-Random-Forest-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Training-a-Random-Forest-Model" title="Permalink"></a></h2><hr/><p>Now that the somewhat arduous process of calculating input features has completed, it&#39;s time to train our model! We&#39;ll use the <strong>training</strong> set for this, which we have previously defined to be located at <code>./TRAINING_FEATURES.h5</code>. Invoke as follows</p><pre><code class="language-julia hljs">train_model(&quot;./TRAINING_FEATURES.h5&quot;, &quot;TRAINED_MODEL.joblib&quot;; verify=true, verify_out=&quot;TRAINING_SET_VERIFICATION.h5&quot;)</code></pre><p>This will train a model based off the information contained within <code>TRAINING_FEATURES.h5</code>, saving it for further use at <code>./TRAINED_MODEL.joblib</code>. The <code>verify</code> keyword arguments means that, once trained, the model will be automatically applied to the training dataset and the predictions will be output, along with the ground truth/correct answers, to the h5 file at <code>TRAINING_SET_VERIFICATION.h5</code>.   </p><hr/><h2 id="Applying-the-trained-model-to-a-radar-scan"><a class="docs-heading-anchor" href="#Applying-the-trained-model-to-a-radar-scan">Applying the trained model to a radar scan</a><a id="Applying-the-trained-model-to-a-radar-scan-1"></a><a class="docs-heading-anchor-permalink" href="#Applying-the-trained-model-to-a-radar-scan" title="Permalink"></a></h2><hr/><p>It&#39;s finally time to begin cleaning radar data! We&#39;ll use the <code>QC_scan</code> function to apply our model to raw moments. Let&#39;s imagine we want to clean the scan located at <code>./cfrad_example_scan</code> using the model we previously trained at <code>TRAINED_MODEL.joblib</code>. By default, this will clean the variables with the names <code>ZZ</code> and <code>VV</code>, though this can be changed by modifying the <code>VARIABLES_TO_QC</code> argument. They will be added to the cfradial file with the names <code>ZZ_QC</code> and <code>VV_QC</code>, respectively, though this suffix can be changed though keyword arguments. Execute as  </p><pre><code class="language-julia hljs">QC_scan(&quot;./cfrad_example_scan&quot;, &quot;./config.txt&quot;, &quot;./TRAINED_MODEL.joblib&quot;)</code></pre><hr/><h2 id="Spatial-Predictors-Reference"><a class="docs-heading-anchor" href="#Spatial-Predictors-Reference">Spatial Predictors Reference</a><a id="Spatial-Predictors-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Spatial-Predictors-Reference" title="Permalink"></a></h2><hr/><p>A key portion of this methodology is deriving &quot;predictors&quot; from raw input radar moments. Raw moments include quantities such as Doppler velocity and reflectivity, while derived variables include things such as the standard deviation of a raw moment across a set of azimuths and ranges in a radar scan. Calculating these features allows the addition of spatial context to the classification problem even when only classifying a single gate. </p><p>Each of the spatial predictors (Currently STD, ISO, and AVG) have predefined &quot;windows&quot; that specify the area they calculate. These windows are specified as matrixes at the top of <a href="https://github.com/irslushy/Ronin.jl/blob/main/src/RoninFeatures.jl">RoninFeatures.jl</a>. They can also be user specified when using <a href="https://irslushy.github.io/Ronin.jl/dev/api.html#Ronin.calculate_features-Tuple{String,%20Vector{String},%20Vector{Matrix{Union{Missing,%20Float64}}},%20String,%20Bool}">calculate_features</a>. &amp;nbsp;</p><h3 id="Currently-Implemented-Functions:"><a class="docs-heading-anchor" href="#Currently-Implemented-Functions:">Currently Implemented Functions:</a><a id="Currently-Implemented-Functions:-1"></a><a class="docs-heading-anchor-permalink" href="#Currently-Implemented-Functions:" title="Permalink"></a></h3><h4 id="**STD(VAR)**"><a class="docs-heading-anchor" href="#**STD(VAR)**"><strong>STD(VAR)</strong></a><a id="**STD(VAR)**-1"></a><a class="docs-heading-anchor-permalink" href="#**STD(VAR)**" title="Permalink"></a></h4><hr/><p>Calculates the standard deviation of each gate of the variable with name VAR in the given radar sweep. By default, gates that contain <code>missing</code> values are ignored in this calculation. Further by default </p><hr/><h4 id="**ISO(VAR)**"><a class="docs-heading-anchor" href="#**ISO(VAR)**"><strong>ISO(VAR)</strong></a><a id="**ISO(VAR)**-1"></a><a class="docs-heading-anchor-permalink" href="#**ISO(VAR)**" title="Permalink"></a></h4><hr/><p>Calculates the &quot;isolation&quot; of each gate of the variable with name VAR in the given radar sweep. This calculation sums the number of adjacent gates in both range and aziumth that contain <code>missing</code> values. </p><hr/><h4 id="**AVG(VAR)**"><a class="docs-heading-anchor" href="#**AVG(VAR)**"><strong>AVG(VAR)</strong></a><a id="**AVG(VAR)**-1"></a><a class="docs-heading-anchor-permalink" href="#**AVG(VAR)**" title="Permalink"></a></h4><hr/><p>Calculates the average of each gate of the variable with name VAR in the given radar sweep. By default, gates that contain <code>missing</code> values are ignored in this calculation. </p><hr/><h3 id="**RNG/NRG**"><a class="docs-heading-anchor" href="#**RNG/NRG**"><strong>RNG/NRG</strong></a><a id="**RNG/NRG**-1"></a><a class="docs-heading-anchor-permalink" href="#**RNG/NRG**" title="Permalink"></a></h3><p>Calculates the range of all radar gates (RNG) from the airborne platform, or normalized by altitude (NRG).  ___ </p><h3 id="**PGG**"><a class="docs-heading-anchor" href="#**PGG**"><strong>PGG</strong></a><a id="**PGG**-1"></a><a class="docs-heading-anchor-permalink" href="#**PGG**" title="Permalink"></a></h3><p><strong>P</strong>robability of <strong>G</strong>round <strong>G</strong>ate - a geometric calculation that gives the probability that a given radar gate is a result of reflection from the ground.  ___</p><h3 id="**AHT**"><a class="docs-heading-anchor" href="#**AHT**"><strong>AHT</strong></a><a id="**AHT**-1"></a><a class="docs-heading-anchor-permalink" href="#**AHT**" title="Permalink"></a></h3><p><strong>A</strong>ircraft <strong>H</strong>eigh<strong>T</strong> - calculates platform height while factoring in Earth curvature.  ___ </p><h3 id="**Implementing-a-new-parameter**"><a class="docs-heading-anchor" href="#**Implementing-a-new-parameter**"><strong>Implementing a new parameter</strong></a><a id="**Implementing-a-new-parameter**-1"></a><a class="docs-heading-anchor-permalink" href="#**Implementing-a-new-parameter**" title="Permalink"></a></h3><p>The code is written in such a way that it would hopefully be relatively easy for a user to add a function of their own to apply to radar data. One could go about this using the following as a guide.    </p><p>There are two types of functions in Ronin: Those that act on radar variables (STD, AVG) and those that operate relatively independent of them (RNG, PGG). Functions that act on variables must be defined using a <strong>3 letter abbreviation</strong> and begin with <code>calc_</code>. Furthermore, the function should take <strong>1 positional</strong> and <strong>2 keyword</strong> arguments. The positional argument should be the variable in matrix form to operate upon. The keyword arguments should be <code>weights</code> and <code>window</code>, where both have the same dimensions. <code>window</code> specifies the area for the spatial parameter to take for each gate, and <code>weights</code> specifies how much weight to give each neighboring gate. For example, if we wanted to define a function that gave us the logartihm of a variable, we could name it <code>LOG</code>, with the function defined in code as</p><pre><code class="language-julia hljs">function calc_LOG(var::Matrix{Union{Missing, Float64}}; weights=default_weights, window=default_window)</code></pre><p>The function should return an array of the same size as <code>var</code>. </p><p>Finally, add the three letter abbreviation <code>LOG</code> to the <code>valid_funcs</code> array at the top of <code>RoninFeatures.jl</code>. </p><p>Congratulations! You&#39;ve added a new function! </p><hr/><h2 id="Data-Conventions/Glossary"><a class="docs-heading-anchor" href="#Data-Conventions/Glossary">Data Conventions/Glossary</a><a id="Data-Conventions/Glossary-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Conventions/Glossary" title="Permalink"></a></h2><hr/><p>Some important data convetions to make note of: </p><ul><li><strong>Meteorological Data is referred to by 1 or <code>true</code></strong></li><li><strong>Non-Meteorological Data is referred to by 0 or <code>false</code></strong></li><li><strong>ELDORA</strong>scan variable names: <ul><li>Raw Velocity: <strong>VV</strong></li><li>QC&#39;ed Velocity (Used for ground truth): <strong>VG</strong></li><li>Raw Reflectivity: <strong>ZZ</strong></li><li>QC&#39;ed Reflectivity (Used for ground truth): <strong>DBZ</strong></li><li>Normalized Coherent Power/Signal Quality Index: <strong>NCP</strong></li></ul></li><li><strong>NOAA TDR</strong> scan variable names: <ul><li>Raw Velocity: <strong>VEL</strong></li><li>QC&#39;ed Velocity (Used for ground truth): <strong>VG</strong></li><li>Raw Reflectivity: <strong>DBZ</strong></li><li>QC&#39;ed Reflectivity: <strong>ZZ</strong></li><li>Normalized Coherent Power/Signal Quality Index: <strong>SQI</strong></li></ul></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api.html">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 6 June 2024 19:47">Thursday 6 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
